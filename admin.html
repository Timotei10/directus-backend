<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Admin panel - Videos Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 text-[#8c5a2b] font-[Inter]">

<h1 class="text-3xl font-semibold mb-6">Admin panel üëë</h1>

<!-- Toggle Videos Button -->
<button id="toggleVideosBtn" class="bg-[#c89d55] hover:bg-[#b0843f] text-white rounded px-4 py-2 mb-6 hidden">
    Videos üé•
</button>
<!--buton blog-->
<button id="toggleBlogBtn" class="bg-[#c89d55] hover:bg-[#b0843f] text-white rounded px-4 py-2 mb-6 hidden">
    Blog üìù
</button>
<!-- Buton afi»ôare / ascundere About -->
<button id="toggleAboutBtn" class="hidden bg-blue-600 text-white px-4 py-2 rounded mb-4">About ‚ÑπÔ∏è</button>
<!-- Toggle Team Section Button -->
<button id="toggleTeamBtn" class="bg-blue-500 text-white px-4 py-2 mt-4 rounded hidden">Team Members üôé‚Äçüôé‚Äç‚ôÄÔ∏èÔ∏è</button>


<!-- Login form -->
<section id="login-section" class="mb-10">
    <h2 class="text-2xl font-bold mb-4">Login</h2>
    <input id="email" type="email" placeholder="Email" class="border p-2 mb-3 w-64" value="admin_wedding@email.com" />
    <input id="password" type="password" placeholder="Password" class="border p-2 mb-3 w-64" value="Password123" />
    <button id="loginBtn" class="bg-[#c89d55] hover:bg-[#b0843f] text-white rounded px-4 py-1">Login</button>
    <p id="loginMessage" class="mt-2 text-red-600"></p>
</section>

<!-- Videos management section, hidden until logged in -->
<section id="videos-section" class="mb-10 hidden">
    <h2 class="text-2xl font-bold mb-4">Videos</h2>
    <button id="addVideoBtn"
            class="mb-4 bg-[#c89d55] hover:bg-[#b0843f] text-white rounded px-4 py-1">
        + Add video
    </button>

    <table class="w-full text-left border">
        <thead class="bg-[#f9f6f1]">
        <tr>
            <th class="p-2 border">ID</th>
            <th class="p-2 border">Title</th>
            <th class="p-2 border">Description</th>
            <th class="p-2 border">Date</th>
            <th class="p-2 border">Video</th>
            <th class="p-2 border">Actions</th>
        </tr>
        </thead>
        <tbody id="videosTableBody"></tbody>
    </table>
</section>

<!-- Blog management section, hidden until toggled -->
<section id="blog-section" class="mb-10 hidden">
    <h2 class="text-2xl font-bold mb-4">Blog Posts</h2>
    <button id="addBlogBtn"
            class="mb-4 bg-[#c89d55] hover:bg-[#b0843f] text-white rounded px-4 py-1">
        + Add Blog Post
    </button>

    <table class="w-full text-left border">
        <thead class="bg-[#f9f6f1]">
        <tr>
            <th class="p-2 border">ID</th>
            <th class="p-2 border">Title</th>
            <th class="p-2 border">Excerpt</th>
            <th class="p-2 border">Date</th>
            <th class="p-2 border">Preview</th>
            <th class="p-2 border">Actions</th>
        </tr>
        </thead>
        <tbody id="blogTableBody"></tbody>
    </table>
</section>

<section id="about-section" class="hidden p-4">
    <h2 class="text-xl font-bold mb-4">Manage About Section</h2>

    <button id="addAboutBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded mb-4">
        ‚ûï Add About
    </button>

    <!-- Tabel About -->
    <table class="w-full border-collapse border border-gray-300">
        <thead>
        <tr>
            <th class="border p-2">ID</th>
            <th class="border p-2">Title</th>
            <th class="border p-2">Description</th>
            <th class="border p-2">Image</th>
            <th class="border p-2">Actions</th>
        </tr>
        </thead>
        <tbody id="aboutTableBody">
        <!-- R√¢nduri generate din JS -->
        </tbody>
    </table>
</section>

<!-- Modal About -->
<div id="aboutModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded shadow-lg w-full max-w-md">
        <h3 id="aboutModalTitle" class="text-lg font-bold mb-4">Edit About Item</h3>

        <form id="aboutForm" onsubmit="return false;" class="space-y-4">
            <input
                    type="text"
                    id="aboutTitle"
                    placeholder="Title"
                    class="border p-2 w-full"
                    required
            />
            <textarea
                    id="aboutDescription"
                    placeholder="Description"
                    class="border p-2 w-full"
                    required
            ></textarea>
            <input type="file" id="aboutImageFile" class="border p-2 w-full" />

            <div class="flex justify-end space-x-2">
                <button
                        id="aboutSave"
                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded"
                        type="submit"
                >
                    Save
                </button>
                <button
                        id="aboutCancelBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded"
                        type="button"
                >
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<!-- TEAM MEMBERS SECTION -->
<section id="team-section" class="hidden mt-6">
    <h2 class="text-2xl font-bold mb-4">Team Members</h2>
    <button id="addTeamBtn" class="mb-4 bg-green-500 text-white px-4 py-2 rounded">Add Member</button>
    <table class="w-full border">
        <thead>
        <tr class="bg-gray-200">
            <th class="p-2 border">ID</th>
            <th class="p-2 border">Name</th>
            <th class="p-2 border">Role</th>
            <th class="p-2 border">Bio</th>
            <th class="p-2 border">Photo</th>
            <th class="p-2 border">Actions</th>
        </tr>
        </thead>
        <tbody id="teamTableBody"></tbody>
    </table>
</section>

<!-- TEAM MODAL -->
<div id="teamModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
    <div class="bg-white w-full max-w-md p-6 rounded shadow-lg">
        <h3 id="teamModalTitle" class="text-xl font-semibold mb-4">Add Team Member</h3>
        <input id="teamName" type="text" placeholder="Name" class="w-full mb-2 p-2 border rounded">
        <input id="teamRole" type="text" placeholder="Role" class="w-full mb-2 p-2 border rounded">
        <textarea id="teamBio" placeholder="Bio" class="w-full mb-2 p-2 border rounded"></textarea>
        <input id="teamPhotoFile" type="file" accept="image/*" class="w-full mb-4">

        <div class="flex justify-end space-x-2">
            <button id="teamCancelBtn" class="bg-gray-400 text-white px-4 py-2 rounded">Cancel</button>
            <button id="teamSave" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
        </div>
    </div>
</div>


<!-- Modal for Add/Edit Video -->
<div id="videoModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
    <div class="bg-white p-6 rounded-lg w-96 max-h-[90vh] overflow-y-auto">
        <h3 id="videoModalTitle" class="text-xl font-semibold mb-4">Add video</h3>
        <input id="videoTitle" type="text" class="w-full border p-2 mb-3" placeholder="Title" />
        <textarea id="videoDescription" class="w-full border p-2 mb-3" placeholder="Description" rows="3"></textarea>
        <input id="videoDate" type="date" class="w-full border p-2 mb-3" />
        <label class="block mb-2 font-semibold">Upload video file:</label>
        <input id="videoFile" type="file" accept="video/*" class="w-full border p-2 mb-5" />
        <div class="flex justify-end gap-3">
            <button id="videoCancel" class="px-4 py-1 border rounded">Cancel</button>
            <button id="videoSave" class="px-4 py-1 bg-[#c89d55] hover:bg-[#b0843f] text-white rounded">Save</button>
        </div>
    </div>
</div>

<!-- Modal for Add/Edit Blog Post -->
<div id="blogModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
    <div class="bg-white p-6 rounded-lg w-96 max-h-[90vh] overflow-y-auto">
        <h3 id="blogModalTitle" class="text-xl font-semibold mb-4">Add Blog Post</h3>
        <input id="blogTitle" type="text" class="w-full border p-2 mb-3" placeholder="Title" />
        <textarea id="blogExcerpt" class="w-full border p-2 mb-3" placeholder="Excerpt" rows="2"></textarea>
        <textarea id="blogContent" class="w-full border p-2 mb-3" placeholder="Content" rows="5"></textarea>
        <input id="blogDate" type="date" class="w-full border p-2 mb-3" />
        <label class="block mb-2 font-semibold">Upload cover image:</label>
        <input id="blogImageFile" type="file" accept="image/*" class="w-full border p-2 mb-5" />
        <div class="flex justify-end gap-3">
            <button id="blogCancel" class="px-4 py-1 border rounded">Cancel</button>
            <button id="blogSave" class="px-4 py-1 bg-[#c89d55] hover:bg-[#b0843f] text-white rounded">Save</button>
        </div>
    </div>
</div>

<script>
    const directusUrl = 'http://localhost:8055';
    let directusToken = null;  // Tokenul JWT va fi salvat aici dupƒÉ login

    const loginSection = document.getElementById('login-section');
    const videosSection = document.getElementById('videos-section');
    const loginBtn = document.getElementById('loginBtn');
    const loginMessage = document.getElementById('loginMessage');

    const videosTableBody = document.getElementById('videosTableBody');
    const videoModal = document.getElementById('videoModal');
    const videoTitleInput = document.getElementById('videoTitle');
    const videoDescriptionInput = document.getElementById('videoDescription');
    const videoDateInput = document.getElementById('videoDate');
    const videoFileInput = document.getElementById('videoFile');

    let editingId = null; // null = add, altfel edit
    let editingVideoFileId = null; // ID-ul fi»ôierului deja uploadat la edit

    // LOGIN FUNCTION
    loginBtn.onclick = async () => {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
            loginMessage.textContent = 'Please enter email and password.';
            return;
        }

        loginMessage.textContent = '';

        try {
            const res = await fetch(`${directusUrl}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            if (!res.ok) {
                loginMessage.textContent = 'Login failed. Check credentials.';
                return;
            }

            const data = await res.json();
            directusToken = data.data.access_token;

            loginSection.classList.add('hidden');

            // Afi»ôeazƒÉ butoanele sec»õiunilor dupƒÉ login
            document.getElementById('toggleVideosBtn').classList.remove('hidden');
            document.getElementById('toggleBlogBtn').classList.remove('hidden');
            document.getElementById('toggleAboutBtn').classList.remove('hidden');
            document.getElementById('toggleTeamBtn').classList.remove('hidden');


            // Ascunde toate sec»õiunile (sau dupƒÉ cum dore»ôti)
            videosSection.classList.add('hidden');
            blogSection.classList.add('hidden');
            aboutSection.classList.add('hidden');
            teamSection.classList.add('hidden');

        } catch (err) {
            loginMessage.textContent = 'Error during login. See console.';
            console.error(err);
        }
    };

    // LOAD VIDEOS
    async function loadVideos() {
        try {
            const res = await fetch(`${directusUrl}/items/Videos?fields=id,title,description,wedding_date,video_file.id,video_file.filename_disk`, {
                headers: {
                    'Authorization': `Bearer ${directusToken}`
                }
            });

            if (!res.ok) {
                const text = await res.text();
                console.error('API error:', res.status, text);
                alert('Error fetching videos: ' + res.status);
                return;
            }

            const data = await res.json();

            if (!data.data) {
                console.error('Response missing data field:', data);
                alert('Invalid API response');
                return;
            }

            videosTableBody.innerHTML = '';

            data.data.forEach(v => {
                const videoFileName = v.video_file ? escapeHtml(v.video_file.filename_disk) : 'No file';
                const weddingDateFormatted = v.wedding_date ? new Date(v.wedding_date).toLocaleDateString() : '';

                const videoPreview = v.video_file
                    ? `<video controls class="w-32 h-20 rounded shadow-md" preload="metadata">
                      <source src="${directusUrl}/assets/${v.video_file.id}" type="video/mp4">
                   </video>`
                    : 'No preview';

                videosTableBody.innerHTML += `
                <tr>
                    <td class="p-2 border">${v.id}</td>
                    <td class="p-2 border">${escapeHtml(v.title)}</td>
                    <td class="p-2 border">${escapeHtml(v.description)}</td>
                    <td class="p-2 border">${weddingDateFormatted}</td>
                    <td class="p-2 border">${videoPreview}</td>
                    <td class="p-2 border">
                        <button onclick="openEdit(${v.id}, '${escapeJs(v.title)}', '${escapeJs(v.description)}', '${v.wedding_date || ''}', '${v.video_file ? v.video_file.id : ''}')" class="mr-2 bg-yellow-300 px-2 rounded">Edit</button>
                        <button onclick="deleteVideo(${v.id})" class="bg-red-400 px-2 rounded text-white">Delete</button>
                    </td>
                </tr>
            `;
            });
        } catch (err) {
            console.error('Fetch error:', err);
            alert('Fetch error, check console');
        }
    }



    // Escape JS for inline onclick
    function escapeJs(str) {
        if (!str) return '';
        return str.replace(/'/g, "\\'").replace(/"/g, '\\"').replace(/\n/g, '\\n');
    }
    // Escape HTML to prevent XSS
    function escapeHtml(text) {
        if (!text) return '';
        return text.replace(/[&<>"']/g, function (m) {
            return {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            }[m];
        });
    }

    // OPEN MODAL ADD/EDIT
    function openEdit(id = null, title = '', description = '', wedding_date = '', videoFileId = '') {
        editingId = id;
        editingVideoFileId = videoFileId || null;
        document.getElementById('videoModalTitle').textContent = id ? 'Edit video' : 'Add video';
        videoTitleInput.value = title;
        videoDescriptionInput.value = description;
        videoDateInput.value = wedding_date ? wedding_date.split('T')[0] : '';
        videoFileInput.value = ''; // reset input file
        videoModal.classList.remove('hidden');
    }


    // SAVE VIDEO (ADD or UPDATE)
    document.getElementById('videoSave').addEventListener('click', async () => {
        const title = videoTitleInput.value.trim();
        const description = videoDescriptionInput.value.trim();
        const date = videoDateInput.value;
        const file = videoFileInput.files[0];


        if (!title) {
            alert('Please fill in the title.');
            return;
        }

        let videoFileId = editingVideoFileId;

        // DacƒÉ este upload de fi»ôier nou
        if (file) {
            try {
                videoFileId = await uploadFile(file);
            } catch (e) {
                alert('Error uploading file');
                return;
            }
        }

        // Construim obiectul video
        const videoData = {
            title,
            description,
            wedding_date: date || null,  // ‚Üê denumirea corectƒÉ conform Directus
            video_file: videoFileId || null
        };


        try {
            let res;
            if (editingId) {
                // Update
                res = await fetch(`${directusUrl}/items/Videos/${editingId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(videoData)
                });
            } else {
                // Add
                res = await fetch(`${directusUrl}/items/Videos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(videoData)
                });
            }

            if (!res.ok) {
                const text = await res.text();
                console.error('Error saving video:', res.status, text);
                alert('Failed to save video');
                return;
            }

            // Success - √Ænchidem modal »ôi re√ÆncƒÉrcƒÉm lista
            closeModal();
            loadVideos();

        } catch (err) {
            console.error(err);
            alert('Error saving video, see console');
        }
    });

    // UPLOAD FILE
    async function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);

        const res = await fetch(`${directusUrl}/files`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${directusToken}`
            },
            body: formData
        });

        if (!res.ok) {
            const text = await res.text();
            console.error('File upload failed:', res.status, text);
            throw new Error('Upload failed');
        }

        const data = await res.json();
        return data.data.id; // returnƒÉm id-ul fi»ôierului uploadat
    }

    // DELETE VIDEO
    async function deleteVideo(id) {
        if (!confirm('Are you sure you want to delete this video?')) return;

        try {
            const res = await fetch(`${directusUrl}/items/Videos/${id}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${directusToken}`
                }
            });

            if (!res.ok) {
                alert('Failed to delete video');
                return;
            }

            loadVideos();

        } catch (err) {
            console.error(err);
            alert('Error deleting video');
        }
    }

    // CLOSE MODAL
    document.getElementById('videoCancel').onclick = closeModal;
    function closeModal() {
        videoModal.classList.add('hidden');
        editingId = null;
        editingVideoFileId = null;
        videoTitleInput.value = '';
        videoDescriptionInput.value = '';
        videoDateInput.value = '';
        videoFileInput.value = '';
    }

    // Add Video button opens modal for new video
    document.getElementById('addVideoBtn').onclick = () => openEdit();
    document.getElementById('toggleVideosBtn').addEventListener('click', () => {
        const section = document.getElementById('videos-section');
        const isHidden = section.classList.contains('hidden');

        if (isHidden) {
            section.classList.remove('hidden');
            loadVideos(); // √ÆncarcƒÉ din nou lista
        } else {
            section.classList.add('hidden');
        }
    });



    //BLOG SECTION JS

   const blogSection = document.getElementById('blog-section');
    const blogTableBody = document.getElementById('blogTableBody');
    const blogModal = document.getElementById('blogModal');
    const blogModalTitle = document.getElementById('blogModalTitle');

    const blogTitleInput = document.getElementById('blogTitle');
    const blogContentInput = document.getElementById('blogContent');
    const blogDateInput = document.getElementById('blogDate');
    const blogImageFileInput = document.getElementById('blogImageFile');

    const addBlogBtn = document.getElementById('addBlogBtn');
    const blogCancelBtn = document.getElementById('blogCancel');
    const blogSaveBtn = document.getElementById('blogSave');

    let editingBlogId = null;
    let editingBlogImageFileId = null;


    // Toggle Blog section
    document.getElementById('toggleBlogBtn').addEventListener('click', () => {
       const isHidden = blogSection.classList.contains('hidden');
        if (isHidden) {
            blogSection.classList.remove('hidden');
            loadBlogs();
        } else {
         blogSection.classList.add('hidden');
       }
    });



    // DupƒÉ ce faci login »ôi verifici tokenul:


    // Open modal for add
    addBlogBtn.addEventListener('click', () => {
        editingBlogId = null;
        editingBlogImageFileId = null;

        blogModal.classList.remove('hidden');
        blogModal.scrollTop = 0;
        blogModalTitle.textContent = 'Add Blog Post';

        blogTitleInput.value = '';
        blogContentInput.value = '';
        blogDateInput.value = '';
        blogImageFileInput.value = '';
    });

    // Cancel modal
    blogCancelBtn.addEventListener('click', () => {
        blogModal.classList.add('hidden');
    });

    // Load blogs
    async function loadBlogs() {
        try {
            const res = await fetch(`${directusUrl}/items/blog?fields=id,title,content,created_at,cover_image.id,cover_image.filename_disk`, {
                headers: { 'Authorization': `Bearer ${directusToken}` }
            });

            if (!res.ok) {
                alert('Error loading blog posts: ' + res.status);
                return;
            }

            const data = await res.json();
            blogTableBody.innerHTML = '';

            data.data.forEach(post => {
                const previewImage = post.cover_image
                    ? `<img src="${directusUrl}/assets/${post.cover_image.id}" alt="Cover" class="w-24 h-16 object-cover rounded shadow-sm">`
                    : 'No image';

                const createdAtFormatted = post.created_at ? new Date(post.created_at).toLocaleDateString() : '';

                blogTableBody.innerHTML += `
                <tr>
                    <td class="p-2 border">${post.id}</td>
                    <td class="p-2 border">${escapeHtml(post.title)}</td>
                    <td class="p-2 border">${escapeHtml(post.content)}</td>
                    <td class="p-2 border">${createdAtFormatted}</td>
                    <td class="p-2 border">${previewImage}</td>
                    <td class="p-2 border">
                        <button onclick="openBlogEdit(${post.id}, '${escapeJs(post.title)}', '${escapeJs(post.content)}', '${post.created_at || ''}', '${post.cover_image ? post.cover_image.id : ''}')"
                                class="mr-2 bg-yellow-300 px-2 rounded">Edit</button>
                        <button onclick="deleteBlog(${post.id})" class="bg-red-400 px-2 rounded text-white">Delete</button>
                    </td>
                </tr>
            `;
            });

        } catch (err) {
            console.error('Error loading blogs:', err);
            alert('Error loading blogs, check console');
        }
    }

    // Open modal for edit
    function openBlogEdit(id, title, content, createdAt, imageFileId) {
        editingBlogId = id;
        editingBlogImageFileId = imageFileId;

        blogModal.classList.remove('hidden');
        blogModalTitle.textContent = 'Edit Blog Post';

        blogTitleInput.value = title;
        blogContentInput.value = content;
        blogDateInput.value = createdAt ? createdAt.split('T')[0] : ''; // input date expects yyyy-mm-dd
        blogImageFileInput.value = ''; // nu schimbƒÉm fi»ôierul automat
    }

    // Delete blog post
    async function deleteBlog(id) {
        if (!confirm('Are you sure you want to delete this blog post?')) return;

        try {
            const res = await fetch(`${directusUrl}/items/blog/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${directusToken}` }
            });

            if (!res.ok) {
                alert('Failed to delete blog post: ' + res.status);
                return;
            }

            loadBlogs();
        } catch (err) {
            console.error('Error deleting blog post:', err);
            alert('Error deleting blog post, check console');
        }
    }

    // Save blog post (add or edit)
    blogSaveBtn.addEventListener('click', async () => {
        const title = blogTitleInput.value.trim();
        const content = blogContentInput.value.trim();
        const date = blogDateInput.value;
        const fileInput = blogImageFileInput.files[0];

        if (!title || !content || !date) {
            alert('Please fill all required fields.');
            return;
        }

        try {
            let coverImageFileId = editingBlogImageFileId;

            // Upload new image file if selected
            if (fileInput) {
                const formData = new FormData();
                formData.append('file', fileInput);

                const uploadRes = await fetch(`${directusUrl}/files`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: formData
                });

                if (!uploadRes.ok) {
                    alert('Failed to upload image file.');
                    return;
                }

                const uploadData = await uploadRes.json();
                coverImageFileId = uploadData.data.id;
            }

            // Prepare body for add or update
            const body = {
                title,
                content,
                created_at: date,
                cover_image: coverImageFileId || null
            };

            let res;
            if (editingBlogId) {
                res = await fetch(`${directusUrl}/items/blog/${editingBlogId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(body)
                });
            } else {
                res = await fetch(`${directusUrl}/items/blog`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(body)
                });
            }

            if (!res.ok) {
                alert('Failed to save blog post: ' + res.status);
                return;
            }

            blogModal.classList.add('hidden');
            loadBlogs();

        } catch (err) {
            console.error('Error saving blog post:', err);
            alert('Error saving blog post, check console');
        }
    });


    // ABOUT SECTION!!!

    // ABOUT SECTION JS

    const aboutSection = document.getElementById('about-section');
    const aboutTableBody = document.getElementById('aboutTableBody');
    const aboutModal = document.getElementById('aboutModal');
    const aboutModalTitle = document.getElementById('aboutModalTitle');

    const aboutTitleInput = document.getElementById('aboutTitle');
    const aboutDescriptionInput = document.getElementById('aboutDescription');
    const aboutImageFileInput = document.getElementById('aboutImageFile');

    const addAboutBtn = document.getElementById('addAboutBtn');
    const aboutCancelBtn = document.getElementById('aboutCancelBtn'); // ‚úÖ corect
    const aboutSaveBtn = document.getElementById('aboutSave');

    let editingAboutId = null;
    let editingAboutImageFileId = null;



    // Toggle About section button
    document.getElementById('toggleAboutBtn').addEventListener('click', () => {
        const isHidden = aboutSection.classList.contains('hidden');
        if (isHidden) {
            aboutSection.classList.remove('hidden');
            loadAbouts();

        } else {
            aboutSection.classList.add('hidden');
        }
    });


    // Open modal for add
    addAboutBtn.addEventListener('click', () => {
        editingAboutId = null;
        editingAboutImageFileId = null;

        aboutModal.classList.remove('hidden');
        aboutModal.scrollTop = 0;
        aboutModalTitle.textContent = 'Add About Item';

        aboutTitleInput.value = '';
        aboutDescriptionInput.value = '';
        aboutImageFileInput.value = '';
    });

    // Cancel modal
    aboutCancelBtn.addEventListener('click', () => {
        aboutModal.classList.add('hidden');

    });

    // Load About items
    async function loadAbouts() {
        try {
            const res = await fetch(`${directusUrl}/items/about?fields=id,title,description,image.id,image.filename_disk`, {
                headers: { 'Authorization': `Bearer ${directusToken}` }
            });

            if (!res.ok) {
                alert('Error loading About items: ' + res.status);
                return;
            }

            const data = await res.json();
            aboutTableBody.innerHTML = '';

            data.data.forEach(item => {
                const previewImage = item.image
                    ? `<img src="${directusUrl}/assets/${item.image.id}" alt="Image" class="w-24 h-16 object-cover rounded shadow-sm">`
                    : 'No image';

                aboutTableBody.innerHTML += `
                <tr>
                    <td class="p-2 border">${item.id}</td>
                    <td class="p-2 border">${escapeHtml(item.title)}</td>
                    <td class="p-2 border">${escapeHtml(item.description)}</td>
                    <td class="p-2 border">${previewImage}</td>
                    <td class="p-2 border">
                        <button onclick="openAboutEdit(${item.id}, '${escapeJs(item.title)}', '${escapeJs(item.description)}', '${item.image ? item.image.id : ''}')"
                                class="mr-2 bg-yellow-300 px-2 rounded">Edit</button>
                        <button onclick="deleteAbout(${item.id})" class="bg-red-400 px-2 rounded text-white">Delete</button>
                    </td>
                </tr>
            `;
            });

        } catch (err) {
            console.error('Error loading About items:', err);
            alert('Error loading About items, check console');
        }
    }

    // Open modal for edit
    function openAboutEdit(id, title, description, imageFileId) {
        editingAboutId = id;
        editingAboutImageFileId = imageFileId;

        aboutModal.classList.remove('hidden');
        aboutModalTitle.textContent = 'Edit About Item';

        aboutTitleInput.value = title;
        aboutDescriptionInput.value = description;
        aboutImageFileInput.value = ''; // nu schimbƒÉm fi»ôierul automat
    }

    // Delete About item
    async function deleteAbout(id) {
        if (!confirm('Are you sure you want to delete this About item?')) return;

        try {
            const res = await fetch(`${directusUrl}/items/about/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${directusToken}` }
            });

            if (!res.ok) {
                alert('Failed to delete About item: ' + res.status);
                return;
            }

            loadAbouts();
        } catch (err) {
            console.error('Error deleting About item:', err);
            alert('Error deleting About item, check console');
        }
    }

    // Save About item (add or edit)
    aboutSaveBtn.addEventListener('click', async () => {
        const title = aboutTitleInput.value.trim();
        const description = aboutDescriptionInput.value.trim();
        const fileInput = aboutImageFileInput.files[0];

        if (!title || !description) {
            alert('Please fill all required fields.');
            return;
        }

        try {
            let imageFileId = editingAboutImageFileId;

            // Upload new image file if selected
            if (fileInput) {
                const formData = new FormData();
                formData.append('file', fileInput);

                const uploadRes = await fetch(`${directusUrl}/files`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: formData
                });

                if (!uploadRes.ok) {
                    alert('Failed to upload image file.');
                    return;
                }

                const uploadData = await uploadRes.json();
                imageFileId = uploadData.data.id;
            }

            // Prepare body for add or update
            const body = {
                title,
                description,
                image: imageFileId || null
            };

            let res;
            if (editingAboutId) {
                res = await fetch(`${directusUrl}/items/about/${editingAboutId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(body)
                });
            } else {
                res = await fetch(`${directusUrl}/items/about`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(body)
                });
            }

            if (!res.ok) {
                alert('Failed to save About item: ' + res.status);
                return;
            }

            aboutModal.classList.add('hidden');
            loadAbouts();

        } catch (err) {
            console.error('Error saving About item:', err);
            alert('Error saving About item, check console');
        }
    });

    // Helper functions for escaping inputs (same as in Blog)
    function escapeHtml(text) {
        if (!text) return '';
        return text.replace(/[&<>"']/g, function (m) {
            switch (m) {
                case '&': return '&amp;';
                case '<': return '&lt;';
                case '>': return '&gt;';
                case '"': return '&quot;';
                case "'": return '&#39;';
                default: return m;
            }
        });
    }

    function escapeJs(text) {
        if (!text) return '';
        return text.replace(/\\/g, '\\\\')
            .replace(/'/g, "\\'")
            .replace(/"/g, '\\"')
            .replace(/\n/g, '\\n')
            .replace(/\r/g, '\\r');
    }


    //TEAM_MEMBERS - SECTION

    const teamSection = document.getElementById('team-section');
    const teamTableBody = document.getElementById('teamTableBody');
    const teamModal = document.getElementById('teamModal');
    const teamModalTitle = document.getElementById('teamModalTitle');

    const teamNameInput = document.getElementById('teamName');
    const teamRoleInput = document.getElementById('teamRole');
    const teamBioInput = document.getElementById('teamBio');
    const teamPhotoFileInput = document.getElementById('teamPhotoFile');

    const addTeamBtn = document.getElementById('addTeamBtn');
    const teamCancelBtn = document.getElementById('teamCancelBtn');
    const teamSaveBtn = document.getElementById('teamSave');

    let editingTeamId = null;
    let editingTeamPhotoId = null;

    // Toggle Team section
    document.getElementById('toggleTeamBtn').addEventListener('click', () => {
        const isHidden = teamSection.classList.contains('hidden');
        if (isHidden) {
            teamSection.classList.remove('hidden');
            loadTeamMembers();
        } else {
            teamSection.classList.add('hidden');
        }
    });

    // Open modal add
    addTeamBtn.addEventListener('click', () => {
        editingTeamId = null;
        editingTeamPhotoId = null;
        teamModal.classList.remove('hidden');
        teamModalTitle.textContent = 'Add Team Member';
        teamNameInput.value = '';
        teamRoleInput.value = '';
        teamBioInput.value = '';
        teamPhotoFileInput.value = '';
    });

    teamCancelBtn.addEventListener('click', () => {
        teamModal.classList.add('hidden');
    });

    // Load team members
    async function loadTeamMembers() {
        try {
            const res = await fetch(`${directusUrl}/items/team_members?fields=id,name,role,bio,photo.id`, {
                headers: { 'Authorization': `Bearer ${directusToken}` }
            });

            const data = await res.json();
            teamTableBody.innerHTML = '';

            data.data.forEach(item => {
                const photo = item.photo ? `<img src="${directusUrl}/assets/${item.photo.id}" class="w-20 h-20 object-cover rounded" alt="Photo">` : 'No photo';

                teamTableBody.innerHTML += `
                    <tr>
                        <td class="p-2 border">${item.id}</td>
                        <td class="p-2 border">${escapeHtml(item.name)}</td>
                        <td class="p-2 border">${escapeHtml(item.role)}</td>
                        <td class="p-2 border">${escapeHtml(item.bio)}</td>
                        <td class="p-2 border">${photo}</td>
                        <td class="p-2 border">
                            <button onclick="editTeamMember(${item.id}, '${escapeJs(item.name)}', '${escapeJs(item.role)}', '${escapeJs(item.bio)}', '${item.photo ? item.photo.id : ''}')" class="bg-yellow-300 px-2 py-1 rounded">Edit</button>
                            <button onclick="deleteTeamMember(${item.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button>
                        </td>
                    </tr>
                `;
            });

        } catch (err) {
            console.error('Error loading team members:', err);
            alert('Failed to load team members.');
        }
    }

    // Edit
    function editTeamMember(id, name, role, bio, photoId) {
        editingTeamId = id;
        editingTeamPhotoId = photoId;

        teamModal.classList.remove('hidden');
        teamModalTitle.textContent = 'Edit Team Member';

        teamNameInput.value = name;
        teamRoleInput.value = role;
        teamBioInput.value = bio;
        teamPhotoFileInput.value = '';
    }

    // Delete
    async function deleteTeamMember(id) {
        if (!confirm('Are you sure you want to delete this team member?')) return;

        try {
            const res = await fetch(`${directusUrl}/items/team_members/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${directusToken}` }
            });

            if (res.ok) {
                loadTeamMembers();
            } else {
                alert('Failed to delete.');
            }
        } catch (err) {
            console.error('Delete error:', err);
            alert('Error deleting member.');
        }
    }

    // Save
    teamSaveBtn.addEventListener('click', async () => {
        const name = teamNameInput.value.trim();
        const role = teamRoleInput.value.trim();
        const bio = teamBioInput.value.trim();
        const file = teamPhotoFileInput.files[0];

        if (!name || !role || !bio) {
            alert('Please fill all fields.');
            return;
        }

        try {
            let photoId = editingTeamPhotoId;

            if (file) {
                const formData = new FormData();
                formData.append('file', file);

                const uploadRes = await fetch(`${directusUrl}/files`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${directusToken}` },
                    body: formData
                });

                const uploadData = await uploadRes.json();
                photoId = uploadData.data.id;
            }

            const body = {
                name,
                role,
                bio,
                photo: photoId || null
            };

            let res;
            if (editingTeamId) {
                res = await fetch(`${directusUrl}/items/team_members/${editingTeamId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(body)
                });
            } else {
                res = await fetch(`${directusUrl}/items/team_members`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${directusToken}`
                    },
                    body: JSON.stringify(body)
                });
            }

            if (!res.ok) {
                alert('Failed to save team member.');
                return;
            }

            teamModal.classList.add('hidden');
            loadTeamMembers();

        } catch (err) {
            console.error('Error saving team member:', err);
            alert('Error saving team member.');
        }
    });


</script>
</body>
</html>
